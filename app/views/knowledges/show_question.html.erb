<script>
  function tr_arrow(p_key, weight)
  {
    var textWeight = " ";
    var textColor = "white";
    if (weight > 0) {
        textWeight = '+' + weight;
        textColor = "green";
    }
    if (weight < 0) {
        textWeight = weight;
        textColor = "red" ;
    }
    document.getElementById('tensor_' + p_key).childNodes[0].nodeValue = textWeight  ;
    document.getElementById('tensor_' + p_key).style.backgroundColor = textColor ;
   }

  function clean_up_arrows()
  {
      <%= @products.collect { |product| "clean_up_one_arrow('#{product.key}');"}.join(' ') %>
  }


  function clean_up_one_arrow(p_key)
  {
    document.getElementById('tensor_' + p_key).childNodes[0].nodeValue = " "  ;
    document.getElementById('product_' + p_key).style.backgroundColor = "white" ;
  }
</script>


<div class="pkz_box">
    <div class="pkz_menu">

      <%= @question.key %> in <%= link_to "questions", "/questions/#{@knowledge.key}"%> of knowledge base <%= link_to @knowledge.key, "/show/#{@knowledge.key}"%>
    </div>
    <div class="pkz_main">


        <table border=1 width="100%">
          <tr>
            <td>
            <div style="font-weight:bold;"><%= @question.label %></div>
            <div style="font-size:90%;">
                <%= pluralize @question.nb_presentation.round, "presentation" %>
                valid=<%= "%d" % @question.nb_presentation_valid %> (<%= "%d" % (@question.proba_valid * 100) %>%),&nbsp;
                no-opinion=<%= "%d" % @question.nb_oo %> (<%= "%d" % (@question.proba_oo * 100) %>%)&nbsp;
                <br/>
                pre-condition:<%= @question.precondition_expression || 'none' %>,&nbsp;
                <%= pluralize @question.nb_choices, "choice" %>,&nbsp;
                <%= @question.is_choice_exclusive ? "exclusive" : "multiple" %>
                <!-- discrimination=<%= "%d" % (@question.discrimination * 100) %>% -->
                <br/>
                <%= link_to_function "toggle xml", "document.getElementById('xml_content').toggle();" %>
            </div>
            </td>
            <th align="center">Products/Weights</th>
          </tr>
          <tr id="xml_content" style="display:none;">
            <td colspan="2" >
              <textarea id="inputfield" style="width:100%; height:300px; background-color:lightblue;">
                <%= @question.to_xml %>
              </textarea>
              <script>
                  var editor = CodeMirror.fromTextArea("inputfield", {
                  parserfile: ["tokenizejavascript.js", "parsejavascript.js"],
                  path: "/codemirror/js/",
                  stylesheet: "/codemirror/css/jscolors.css" });
              </script>
            </td>
          </tr>
          <tr>
            <td width="50%" valign="top" >
              <ol>
                  <% for choice in @question.choices %>
                    <li style="margin-bottom:10px;">
                      <img src='/images/icons/play.png' onmouseover="<%= choice.generate_javascript_tensors(@products) %>" onmouseout="clean_up_arrows();" />
                      
                      <span style="font-weight:bold;"><%= choice.label.inspect %></span>
                      <div  style="font-size:90%;">
                        statistic:
                        ok=<%= "%d" % choice.nb_ok %> (<%= "%d" % (choice.proba_ok * 100) %>%),&nbsp;
                        ko=<%= "%d" % choice.nb_ko %> (<%= "%d" % (choice.proba_ko * 100) %>%)&nbsp;
                        <!-- discrimination=<%= "%d" % (choice.discrimination * 100) %>%,&nbsp; -->
                      <div>
                    </li>
                  <% end %>
                </ol>
            </td>
            <td width="50%" valign="top" >
              <div style="-moz-column-count:2">
                  <ul>
                      <% for product in @products %>
                          <li id="product_<%= product.key %>">
                          <span id="tensor_<%= product.key %>" style="border:1px solid white;">&nbsp;&nbsp;</span>
                          <%= product.key %>&nbsp;
                          </li>
                      <% end %>
                   </ul>
               </div>
            </td>
          </tr>

        </table>

    </div>

</div>